require("dotenv").config();
const axios = require("axios");

const express = require("express");
const cors = require("cors");
const app = express();

const { TelegramClient } = require("telegram");
const { StringSession } = require("telegram/sessions");
const { NewMessage } = require("telegram/events/index.js");

const API_ID = +process.env.API_ID;
const API_HASH = process.env.API_HASH;
const SESSION = process.env.SESSION;

app.use(cors({ methods: ["GET", "POST"] }));
app.use(express.json());

async function startApp() {
  try {
    const stringSession = new StringSession(SESSION);
    const client = new TelegramClient(stringSession, API_ID, API_HASH, {
      connectionRetries: 5,
    });
    console.log("‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!");

    await client.start();

    async function findChannel() {
      const dialogs = await client.getDialogs();

      const chat_slay = dialogs.find((chat) => chat.name === "42 FanLab Chat");
      console.log(chat_slay);
    }

    //await findChannel();
    // vexed  {chat:-1003250534097, channel: 2769199478}

    const commentGroupsId = [ {chat: -1002398372400, channel: 2106543498}, { chat: -1003299332773, channel: 3183906489 }];

    commentGroupsId.forEach(async (item) => {
      await runNotifucation(item);
    });

    async function runNotifucation(commentGroupId) {
      client.addEventHandler(async (event) => {
        const message = event.message;
       

        if (Number(message.chatId.valueOf()) !== commentGroupId.chat) return;

        if (message.fwdFrom && message.fwdFrom.channelPost &&
          message.fwdFrom.fromId.className === "PeerChannel" &&
          Number(message.fwdFrom.fromId.channelId) === commentGroupId.channel) {
          console.log("üÜï –ù–æ–≤—ã–π –ø–æ—Å—Ç –∏–∑ –∫–∞–Ω–∞–ª–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω!");

          const photos = [
            "https://i.ibb.co/PvWMxRhF/5opka-1.jpg",
            "https://i.ibb.co/hr8tr8X/5opka-2.jpg",
            "https://i.ibb.co/1fLnBTsG/5opka-3.jpg",
            "https://i.ibb.co/x8sJzZN6/5opka-5.jpg",
            "https://i.ibb.co/BKrYxcnW/5opka-6.jpg",
            "https://i.ibb.co/Y4sz4NR5/5opka-7.jpg",
            "https://i.ibb.co/B2hN7qTt/5opka-8.jpg",
            "https://i.ibb.co/B532hrMC/5opka-9.jpg",
            "https://i.ibb.co/s9pySMkx/5opka-10.jpg",
            "https://i.ibb.co/dwz4yTr5/5opka-11.jpg",
            "https://i.ibb.co/8ndj3KcR/5opka-12.jpg",
            "https://i.ibb.co/TqBB296G/5opka-13.jpg"
          ];
          const comments = [
            "–§—Ä–∏–∫–ª–µ–Ω–¥ –∑–∞–∫—Ä—ã–ª—Å—è, –Ω–æ –ª–µ–≥–µ–Ω–¥–∞ –ø—è—Ç—ë—Ä–∫–∏ –∂–∏–≤—ë—Ç ‚Äî –±–æ—Å—Å –Ω–µ —Ç–µ—Ä—è–µ—Ç —Ö–≤–∞—Ç–∫—É, –æ–Ω –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ –Ω–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å.",
            "42 –±—Ä–∞—Ç—É—Ö–∏ –∏ —Ñ—É–≥–æ–±–æ—Ç—ã –∑–Ω–∞—é—Ç: –∫–∞–∂–¥–∞—è –ø–∞—É–∑–∞ —É –±–æ—Å—Å–∞ ‚Äî —ç—Ç–æ –∑–∞—Ç–∏—à—å–µ –ø–µ—Ä–µ–¥ –æ—á–µ—Ä–µ–¥–Ω—ã–º –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–º —Ö–∞–π–ø–æ–º.",
            "–õ–ü–®–∫–∞ –∏ –°—Ç–∞—Ä—ã–π –ë–æ–≥ —Å–Ω–æ–≤–∞ —á—Ç–æ-—Ç–æ –º—É–ª—è—Ç, –Ω–æ 5opka –¥–µ–ª–∞–µ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç, –∞ –Ω–µ —Ä–∞–∑–≥–æ–≤–æ—Ä—ã ‚Äî –∏ –≤ —ç—Ç–æ–º –≤—Å—è —Ä–∞–∑–Ω–∏—Ü–∞.",
            "–§—É–≥–æ–±–æ—Ç—ã –Ω–µ –≥—Ä—É—Å—Ç—è—Ç, –æ–Ω–∏ –≥–æ—Ç–æ–≤—è—Ç –¥–≤–∏–∂ ‚Äî –≤–µ–¥—å –±–æ—Å—Å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –Ω–∞ Slay 2025 –∑–∞ –∑–∞—Å–ª—É–∂–µ–Ω–Ω–æ–π –∫–æ—Ä–æ–Ω–æ–π!",
            "–§—Ä–∏–∫–ª–µ–Ω–¥-2 –∑–∞–∫—Ä—ã–ª—Å—è –∫–∞–∫ —Å–µ—Ä–∏–∞–ª –Ω–∞ –ø–∏–∫–µ ‚Äî —Ç–µ–ø–µ—Ä—å –≤—Å–µ –∂–¥—É—Ç –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Å –Ω–æ–≤—ã–º –≤–∞–π–±–æ–º –æ—Ç 5opka.",
            "–ö–∞–∂–¥—ã–π —Å—Ç—Ä–∏–º –ø—è—Ç—ë—Ä–∫–∏ ‚Äî –∫–∞–∫ —Ñ–µ—Å—Ç–∏–≤–∞–ª—å, –≥–¥–µ —á–∞—Ç –ø–æ—ë—Ç, –±—Ä–∞—Ç—É—Ö–∏ –¥–≤–∏–≥–∞—é—Ç—Å—è, –∞ —Ñ—É–≥–æ–±–æ—Ç—ã –∑–∞—Ä—è–∂–∞—é—Ç –∞—Ç–º–æ—Å—Ñ–µ—Ä—É.",
            "–õ–ü–®–∫–∞ –º–æ–∂–µ—Ç —à—É–º–µ—Ç—å, –°—Ç–∞—Ä—ã–π –ë–æ–≥ ‚Äî –∑–∞–≤–∏–¥–æ–≤–∞—Ç—å, –Ω–æ —Å–∏–ª–∞ 42 –±—Ä–∞—Ç—É—Ö –Ω–µ –∑–Ω–∞–µ—Ç –ø—Ä–µ–≥—Ä–∞–¥.",
            "–ö–æ–≥–¥–∞ –±–æ—Å—Å –≥–æ–≤–æ—Ä–∏—Ç ¬´–ø–æ–µ—Ö–∞–ª–∏¬ª, –¥–∞–∂–µ –¢–≤–∏—á-—Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞—á–∏–Ω–∞—é—Ç –≤–∏–±—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ç —ç–Ω–µ—Ä–≥–∏–∏.",
            "–ó–∞–∫—Ä—ã—Ç–∏–µ –§—Ä–∏–∫–ª–µ–Ω–¥–∞ ‚Äî –Ω–µ –∫–æ–Ω–µ—Ü, –∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –≤–µ–ª–∏–∫–æ–π —Å–∞–≥–∏ –ø—Ä–æ –Ω–∞—Å—Ç–æ—è—â–µ–≥–æ –∫–æ—Ä–æ–ª—è —Å—Ç—Ä–∏–º–æ–≤.",
            "–ù–∏–∫–∞–∫–∏–µ –≤—Ä–∞–≥–∏ –Ω–µ –ø—Ä–æ–±—å—é—Ç –∞—É—Ä—É 5opka ‚Äî –æ–Ω –≤—ã—Å—Ç–æ—è–ª –ø—Ä–æ—Ç–∏–≤ –≤—Å–µ—Ö –∏ —Å–Ω–æ–≤–∞ –∏–¥—ë—Ç –∑–∞ —Å–≤–æ–∏–º.",
            "–§—É–≥–æ–±–æ—Ç—ã –≤ –æ–Ω–ª–∞–π–Ω–µ, —á–∞—Ç –∫–∏–ø–∏—Ç, –∞ –±—Ä–∞—Ç—É—Ö–∏ –¥–µ—Ä–∂–∞—Ç —Å—Ç—Ä–æ–π ‚Äî –≤–æ—Ç –ø–æ—á–µ–º—É –º—ã –Ω–µ–ø–æ–±–µ–¥–∏–º—ã.",
            "5opka –Ω–µ –ø—Ä–æ—Å—Ç–æ —Å—Ç—Ä–∏–º–µ—Ä ‚Äî –æ–Ω –∫—É–ª—å—Ç—É—Ä–Ω—ã–π –∫–æ–¥ –¢–≤–∏—á–∞, —Å–∏–º–≤–æ–ª –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∏ –∏—Å–∫—Ä–µ–Ω–Ω–µ–≥–æ –≤–∞–π–±–∞.",
            "–õ–ü–®–∫–∞ —Ö–∞–π–ø–∏—Ç, –°—Ç–∞—Ä—ã–π –ë–æ–≥ –±—É–±–Ω–∏—Ç, –∞ –±–æ—Å—Å –ø—Ä–æ—Å—Ç–æ –¥–µ–ª–∞–µ—Ç —à–æ—É, –∫–æ—Ç–æ—Ä–æ–µ –ø–æ—Ç–æ–º —Å—Ç–∞–Ω–µ—Ç –º–µ–º–æ–º.",
            "–§—Ä–∏–∫–ª–µ–Ω–¥ –∑–∞–∫—Ä—ã–ª—Å—è –≥—Ä–æ–º–∫–æ, –∏ —ç—Ç–æ —Ç–æ–ª—å–∫–æ –ø–æ–¥–æ–≥—Ä–µ–ª–æ –∏–Ω—Ç–µ—Ä–µ—Å –∫ —Å–ª–µ–¥—É—é—â–µ–π —ç–ø–æ—Ö–µ –ª–µ–≥–µ–Ω–¥—ã.",
            "Slay 2025 –∂–¥—ë—Ç –Ω–∞—Å, –∏ 42 –±—Ä–∞—Ç—É—Ö–∏ —É–∂–µ –¥–µ—Ä–∂–∞—Ç –º–µ—Å—Ç–æ –ø–æ–¥ —Ç—Ä–æ–Ω –Ω–∞—à–µ–≥–æ –±–æ—Å—Å–∞.",
            "–§—É–≥–æ–±–æ—Ç—ã ‚Äî –Ω–µ –∑—Ä–∏—Ç–µ–ª–∏, –∞ —Å–µ–º—å—è, –≥–¥–µ –∫–∞–∂–¥—ã–π –¥–æ–Ω–∞—Ç ‚Äî –∞–∫—Ç –ª—é–±–≤–∏ –∫ –Ω–∞—Å—Ç–æ—è—â–µ–º—É –∫–æ–Ω—Ç–µ–Ω—Ç—É.",
            "–ö–∞–∂–¥—ã–π —Å—Ç—Ä–∏–º ‚Äî —ç—Ç–æ –Ω–æ–≤–∞—è –≥–ª–∞–≤–∞ –≤ –∫–Ω–∏–≥–µ, –≥–¥–µ 5opka –ø–∏—à–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –¢–≤–∏—á–∞ –±–µ–∑ —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–≤.",
            "–ö–æ–≥–¥–∞ –¥—Ä—É–≥–∏–µ –∏–≥—Ä–∞—é—Ç –≤ —Ö–∞–π–ø, –±–æ—Å—Å –µ–≥–æ —Å–æ–∑–¥–∞—ë—Ç ‚Äî –≤–æ—Ç –ø–æ—á–µ–º—É –æ–Ω –≤–Ω–µ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏–∏.",
            "–°—Ç–∞—Ä—ã–π –ë–æ–≥ –ø—ã—Ç–∞–µ—Ç—Å—è —Å–ø–æ—Ä–∏—Ç—å, –Ω–æ –∫–∞–∫ –º–æ–∂–Ω–æ —Å–ø–æ—Ä–∏—Ç—å —Å –∏–∫–æ–Ω–æ–π —Ü–µ–ª–æ–π —ç–ø–æ—Ö–∏ Twitch?",
            "–§—Ä–∏–∫–ª–µ–Ω–¥ –±—ã–ª –∞—Ä–µ–Ω–æ–π, —Ç–µ–ø–µ—Ä—å –∞—Ä–µ–Ω–∞ ‚Äî –≤–µ—Å—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç, –∏ –±–æ—Å—Å —Å–Ω–æ–≤–∞ –≤—ã—Ö–æ–¥–∏—Ç –≤ —Ü–µ–Ω—Ç—Ä —Å–≤–µ—Ç–∞.",
            "–õ–ü–®–∫–∞ –Ω–µ –ø–æ–Ω–∏–º–∞–µ—Ç, —á—Ç–æ –ø—è—Ç—ë—Ä–∫–∞ ‚Äî –Ω–µ –ø—Ä–æ—Å—Ç–æ –Ω–∏–∫, –∞ —Å–∏–º–≤–æ–ª –≤—Ä–µ–º–µ–Ω–∏ –∏ —Å–∏–ª—ã –∫–æ–Ω—Ç–µ–Ω—Ç–∞.",
            "–§—É–≥–æ–±–æ—Ç—ã –¥–≤–∏–≥–∞—é—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ ‚Äî –ø–æ—Ç–æ–º—É —á—Ç–æ —É –Ω–∞—Å –æ–¥–∏–Ω –≤–∞–π–±, –æ–¥–Ω–æ –∏–º—è, –æ–¥–∏–Ω –±–æ—Å—Å.",
            "–ü—è—Ç—ë—Ä–∫–∞ ‚Äî —ç—Ç–æ –±—Ä–µ–Ω–¥, —Å—Ç–∏–ª—å, –≤–∞–π–± –∏ –¥–≤–∏–∂–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å.",
            "42 –±—Ä–∞—Ç—É—Ö–∏ –Ω–µ —Å–¥–∞—é—Ç—Å—è ‚Äî –≤–µ–¥—å –º—ã —á–∞—Å—Ç—å –ª–µ–≥–µ–Ω–¥—ã, –∫–æ—Ç–æ—Ä–∞—è —Ç–æ–ª—å–∫–æ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –∑–∞–Ω–æ–≤–æ.",
            "–•–µ–π—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç, —Ç—Ä–µ–Ω–¥—ã –º–µ–Ω—è—é—Ç—Å—è, –∞ –∏–º—è –ø—è—Ç—ë—Ä–∫–∏ –æ—Å—Ç–∞—ë—Ç—Å—è –≤ —Å–µ—Ä–¥—Ü–∞—Ö –∑—Ä–∏—Ç–µ–ª–µ–π –Ω–∞–≤—Å–µ–≥–¥–∞.",
            "Slay King ‚Äî –Ω–µ —Ç–∏—Ç—É–ª, —ç—Ç–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥—É—à–∏, –∏ —É –±–æ—Å—Å–∞ –æ–Ω–æ –≤ –î–ù–ö —Å —Ä–æ–∂–¥–µ–Ω–∏—è.",
            "–î–∞–∂–µ –î–º–∏—Ç—Ä–∏–π –ú–∞–ª–∏–∫–æ–≤ —Å–∫–∞–∑–∞–ª: ¬´–£–≤–∞–∂–µ–Ω–∏–µ –ø—è—Ç—ë—Ä–∫–µ¬ª ‚Äî –∏ —ç—Ç–æ –º–æ—Å—Ç –º–µ–∂–¥—É —Å—Ü–µ–Ω–æ–π –∏ Twitch-–≤—Å–µ–ª–µ–Ω–Ω–æ–π.",
            "–ö–æ–≥–¥–∞ –ú–∞–ª–∏–∫–æ–≤ –∏ 5opka –≤—Å—Ç—Ä–µ—Ç–∏–ª–∏—Å—å, –≤—Ä–µ–º—è –Ω–∞ —Å–µ–∫—É–Ω–¥—É –æ—Å—Ç–∞–Ω–æ–≤–∏–ª–æ—Å—å ‚Äî —Ä–µ—Å–ø–µ–∫—Ç –ø–æ–∫–æ–ª–µ–Ω–∏–π —Å–æ—Å—Ç–æ—è–ª—Å—è.",
            "–ú–∞–ª–∏–∫–æ–≤ –ø–æ–Ω—è–ª –≤–∞–π–± —Ñ—É–≥–æ–±–æ—Ç–æ–≤ ‚Äî —Å–∫–∞–∑–∞–ª, —á—Ç–æ —ç–Ω–µ—Ä–≥–∏—è 42 –±—Ä–∞—Ç—É—Ö –Ω–∞–ø–æ–º–∏–Ω–∞–µ—Ç –µ–º—É –∑–∞–ª –Ω–∞ –∫–æ–Ω—Ü–µ—Ä—Ç–µ.",
            "–ü—è—Ç—ë—Ä–∫–∞ —É–≤–∞–∂–∞–µ—Ç –ú–∞–ª–∏–∫–æ–≤–∞, –ú–∞–ª–∏–∫–æ–≤ —É–≤–∞–∂–∞–µ—Ç –ø—è—Ç—ë—Ä–∫—É ‚Äî –≤–æ—Ç —á—Ç–æ –∑–Ω–∞—á–∏—Ç –Ω–∞—Å—Ç–æ—è—â–∞—è –≤–∑–∞–∏–º–Ω–∞—è –ª–µ–≥–µ–Ω–¥–∞.",
            "–§—É–≥–æ–±–æ—Ç—ã —É–ª—ã–±–∞—é—Ç—Å—è: –ú–∞–ª–∏–∫–æ–≤ —Å –Ω–∞–º–∏, –õ–ü–®–∫–∞ –∑–ª–∏—Ç—Å—è, –∞ –±–æ—Å—Å –∏–¥—ë—Ç –∫ Slay King —Å —á–∏—Å—Ç—ã–º —Å–µ—Ä–¥—Ü–µ–º."
          ];
          
          

          const hashtags = [
            "#–ü—è—Ç–µ—Ä–∫–∞", 
            "#5opka", 
            "#–§—É–≥–æ–±–æ—Ç—ã", 
            "#42–ë—Ä–∞—Ç—É—Ö–∏", 
            "#Slay2025", 
            "#SlayKing", 
            "#–§—Ä–∏–∫–ª–µ–Ω–¥", 
            "#–ü—Ä–æ–µ–∫—Ç–ì–æ–¥–∞", 
            "#–ú–µ–º–ì–æ–¥–∞", 
            "#5opkaBoss", 
            "#–ë–æ—Å—Å–¢–≤–∏—á–∞", 
            "#–õ–µ–≥–µ–Ω–¥–∞–¢–≤–∏—á–∞", 
            "#–ì–µ–Ω–∏–π–ö–æ–Ω—Ç–µ–Ω—Ç–∞", 
            "#–ú–µ–¥–∏–∞–ê–∫—É–ª–∞", 
            "#5opka–ê—Ä–º–∏—è", 
            "#–ú—ã42", 
            "#–ñ–æ–ø–∞XXL", 
            "#–¢—Ä–µ–∫42", 
            "#–ë—Ä–∞—Ç—É—Ö–∏–ó–∞–ë–æ—Å—Å–∞", 
            "#–ü—è—Ç–µ—Ä–∫–∞–ù–∞–≤—Å–µ–≥–¥–∞", 
            "#–§—É–≥–æ–±–æ—Ç—ã–û–Ω–ª–∞–π–Ω", 
            "#5opkaSlayKing", 
            "#–°–ª–∞–≤–∞–ë—É—Å—Ç–µ—Ä–í–®–æ–∫–µ", 
            "#–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä—ã–í–®–æ–∫–µ", 
            "#–§—É–≥–æ–±–æ—Ç–î–≤–∏–∂", 
            "#–§—Ä–∏–∫–ª–µ–Ω–¥–¢–æ–ø", 
            "#–¢–≤–∏—á–ù–∞—à–î–æ–º", 
            "#–ö–æ–Ω—Ç–µ–Ω—Ç–ë–æ–≥–∞", 
            "#–ü—è—Ç–µ—Ä–∫–∞–ó–∞–≤–æ–∑–∏—Ç", 
            "#5opka–ú–µ–º–ú–∞—Å—Ç–µ—Ä", 
            "#–ü—è—Ç–µ—Ä–∫–∞2025", 
            "#–¢–æ–ø–∏–º–ó–∞–ü—è—Ç–µ—Ä–∫—É", 
            "#–ü—è—Ç–µ—Ä–∫–∞–ë–æ—Å—Å", 
            "#–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π–ö–æ–Ω—Ç–µ–Ω—Ç", 
            "#–§—É–≥–æ–±–æ—Ç—ã–°–∏–ª–∞", 
            "#42–ò–¥–µ—Ç–ö–ü–æ–±–µ–¥–µ", 
            "#–ë—Ä–∞—Ç—Å—Ç–≤–æ42", 
            "#5opkaForever", 
            "#5opkaCommunity", 
            "#–§—Ä–∏–∫–ª–µ–Ω–¥–ù–∞–≤—Å–µ–≥–¥–∞", 
            "#–¢–≤–∏—á–õ–µ–≥–µ–Ω–¥–∞", 
            "#5opkaGenius"
          ];
          

          const randomPhoto = photos[Math.floor(Math.random() * photos.length)];
          const hashtaId = Math.floor(Math.random() * hashtags.length);
          const randomComment =
            comments[Math.floor(Math.random() * comments.length)];

          await client.sendMessage(commentGroupId.chat, {
            file: randomPhoto,
            message: `<blockquote><b>${randomComment}</b></blockquote>\n ${
              hashtags[hashtaId]
            } ${hashtags[hashtaId > hashtags.length - 2 ? 0 : hashtaId + 1]} ${
              hashtags[hashtaId > hashtags.length - 3 ? 0 : hashtaId + 2]
            }`,
            parseMode: "html",
            replyTo: message.id,
          });

          console.log("‚úÖ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω:");
        }
      }, new NewMessage({ chats: [commentGroupId.chat] }));
    }
    app.get("/sleep", async (req, res) => {
      res.send({ type: 200 });
    });
  } catch (err) {
    console.error("‚ùå –ù–µ–ø—Ä–µ–¥–≤–∏–¥–µ–Ω–Ω–∞—è –æ—à–∏–±–∫–∞:", err);
    process.exit(1);
  }
}
startApp();

app.listen(3001, (err) => {
  err ? err : console.log("STARTED SERVER");
});
