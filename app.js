require("dotenv").config();
const axios = require("axios");

const express = require("express");
const cors = require("cors");
const app = express();

const { TelegramClient } = require("telegram");
const { StringSession } = require("telegram/sessions");
const { NewMessage } = require("telegram/events/index.js");

const API_ID = +process.env.API_ID;
const API_HASH = process.env.API_HASH;
const SESSION = process.env.SESSION;

app.use(cors({ methods: ["GET", "POST"] }));
app.use(express.json());

async function startApp() {
  try {
    const stringSession = new StringSession(SESSION);
    const client = new TelegramClient(stringSession, API_ID, API_HASH, {
      connectionRetries: 5,
    });
    console.log("‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!");

    await client.start();

    async function findChannel() {
      const dialogs = await client.getDialogs();

      const chat_slay = dialogs.find((chat) => chat.name === "42 FanLab Chat");
      console.log(chat_slay);
    }

    //await findChannel();
    // vexed  {chat:-1003250534097, channel: 2769199478}

    const commentGroupsId = [ {chat: -1002398372400, channel: 2106543498}, { chat: -1003299332773, channel: 3183906489 }];

    commentGroupsId.forEach(async (item) => {
      await runNotifucation(item);
    });

    async function runNotifucation(commentGroupId) {
      client.addEventHandler(async (event) => {
        const message = event.message;
       

        if (Number(message.chatId.valueOf()) !== commentGroupId.chat) return;

        if (message.fwdFrom && message.fwdFrom.channelPost &&
          message.fwdFrom.fromId.className === "PeerChannel" &&
          Number(message.fwdFrom.fromId.channelId) === commentGroupId.channel) {
          console.log("üÜï –ù–æ–≤—ã–π –ø–æ—Å—Ç –∏–∑ –∫–∞–Ω–∞–ª–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω!");

          const photos = [
            "https://i.ibb.co/PvWMxRhF/5opka-1.jpg",
            "https://i.ibb.co/hr8tr8X/5opka-2.jpg",
            "https://i.ibb.co/1fLnBTsG/5opka-3.jpg",
            "https://i.ibb.co/x8sJzZN6/5opka-5.jpg",
            "https://i.ibb.co/BKrYxcnW/5opka-6.jpg",
            "https://i.ibb.co/Y4sz4NR5/5opka-7.jpg",
            "https://i.ibb.co/B2hN7qTt/5opka-8.jpg",
            "https://i.ibb.co/B532hrMC/5opka-9.jpg",
            "https://i.ibb.co/s9pySMkx/5opka-10.jpg",
            "https://i.ibb.co/dwz4yTr5/5opka-11.jpg",
            "https://i.ibb.co/8ndj3KcR/5opka-12.jpg",
            "https://i.ibb.co/TqBB296G/5opka-13.jpg"
          ];
          const comments = [
            "–ú—ã ‚Äî 42 –±—Ä–∞—Ç—É—Ö–∏ –∏ —Ñ—É–≥–æ–±–æ—Ç—ã, –Ω–µ—Å—ë–º –ø—è—Ç—ë—Ä–∫—É –∫ —Ç—Ä–æ–π–Ω–æ–π –∫–æ—Ä–æ–Ω–µ Slay 2025 ‚Äî –±–æ—Å—Å –∏–¥—ë—Ç –∑–∞ —Å–≤–æ–∏–º!",
            "–ü—è—Ç—ë—Ä–∫–∞ ‚Äî –º–µ–¥–∏–∞-–∞–∫—É–ª–∞, –≥–µ–Ω–∏–π –∏ –ª–µ–≥–µ–Ω–¥–∞, –¥–≤–∞–∂–¥—ã –º–µ–º-–≥–æ–¥–∞, —Ç–µ–ø–µ—Ä—å –∫–æ—Ä–æ–ª—å Slay King 2025!",
            "–§—Ä–∏–∫–ª–µ–Ω–¥ ‚Äî –ø—Ä–æ–µ–∫—Ç –≥–æ–¥–∞, –∞ 5opka ‚Äî —Å–µ—Ä–¥—Ü–µ –≤—Å–µ–≥–æ –¢–≤–∏—á–∞, –∏ –Ω–∞—Å 42 –±—Ä–∞—Ç—É—Ö–∏ –Ω–µ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å!",
            "–° 2023 –∏ 2024 –º–µ–º-–≥–æ–¥–∞ –∑–∞ –ø–ª–µ—á–∞–º–∏, –ø—è—Ç—ë—Ä–∫–∞ –∑–∞–±–∏—Ä–∞–µ—Ç –≤—Å—ë –≤ 2025 ‚Äî –º—ã –∏–¥—ë–º –∫ –∞–±—Å–æ–ª—é—Ç—É!",
            "–ù–∏ –õ–ü–®–∫–∞, –Ω–∏ –ö–≤–∞–¥—Ä–∞—Ç–Ω—ã–π, –Ω–∏ –°–∫—Ä—ã–Ω–Ω–∏–∫ ‚Äî –Ω–∏–∫—Ç–æ –Ω–µ —É—Å—Ç–æ–∏—Ç –ø—Ä–æ—Ç–∏–≤ —ç–Ω–µ—Ä–≥–∏–∏ –±–æ—Å—Å–∞ –¢–≤–∏—á–∞!",
            "–ö–æ–≥–¥–∞ —Ñ—É–≥–æ–±–æ—Ç—ã –≤—ã—Ö–æ–¥—è—Ç –æ–Ω–ª–∞–π–Ω, –≤–µ—Å—å Twitch –¥—Ä–æ–∂–∏—Ç ‚Äî –ø–æ—Ç–æ–º—É —á—Ç–æ –ø—è—Ç—ë—Ä–∫–∞ —Å—Ç—Ä–∏–º–∏—Ç!",
            "–°–ª–∞–≤–∞ –ë—É—Å—Ç–µ—Ä –≤ —à–æ–∫–µ, –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä—ã –≤ –ø–∞–Ω–∏–∫–µ ‚Äî –ø—è—Ç—ë—Ä–∫–∞ —Å–Ω–æ–≤–∞ –±–µ—Ä—ë—Ç Slay King!",
            "42 –±—Ä–∞—Ç—É—Ö–∏ –∑–∞ –ø—è—Ç—ë—Ä–∫—É ‚Äî –Ω–µ –ø—Ä–æ—Å—Ç–æ —Ñ–∞–Ω–±–∞–∑–∞, –∞ —Å–∏–ª–∞, –∫–æ—Ç–æ—Ä–∞—è —Ç–≤–æ—Ä–∏—Ç –∏—Å—Ç–æ—Ä–∏—é –¢–≤–∏—á–∞!",
            "–ö–∞–∂–¥—ã–π —Å—Ç—Ä–∏–º –ø—è—Ç—ë—Ä–∫–∏ ‚Äî —Å–æ–±—ã—Ç–∏–µ, –∫–∞–∂–¥—ã–π –º–µ–º ‚Äî –ª–µ–≥–µ–Ω–¥–∞, –∫–∞–∂–¥–∞—è –ø–æ–±–µ–¥–∞ ‚Äî –∑–∞—Å–ª—É–∂–µ–Ω–Ω–∞!",
            "–§—Ä–∏–∫–ª–µ–Ω–¥ ‚Äî –Ω–µ —Å–µ—Ä–≤–µ—Ä, –∞ –≤—Å–µ–ª–µ–Ω–Ω–∞—è, —Å–æ–∑–¥–∞–Ω–Ω–∞—è –±–æ—Å—Å–æ–º, –≥–¥–µ —Ä–æ–∂–¥–∞—é—Ç—Å—è –º–µ–º—ã –∏ –ø–æ–±–µ–¥—ã!",
            "–ü—è—Ç—ë—Ä–∫–∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ —Å—Ç—Ä–∏–º–µ—Ä ‚Äî –æ–Ω —ç–ø–æ—Ö–∞, —Å–∏–º–≤–æ–ª –∫–æ–Ω—Ç–µ–Ω—Ç–∞, —Ö–∞—Ä–∏–∑–º—ã –∏ –∏—Å–∫—Ä–µ–Ω–Ω–µ–≥–æ –¥–≤–∏–∂–∞!",
            "–ñ–æ–ø–∞ XXL –∏ 42 ‚Äî —Ö–∏—Ç—ã, —á—Ç–æ –∫–∞—á–∞—é—Ç –º–∏—Ä, –≤–µ–¥—å –ø—è—Ç—ë—Ä–∫–∞ –¥–µ–ª–∞–µ—Ç –¥–∞–∂–µ –º—É–∑—ã–∫—É —ç–ø–∏—á–Ω–æ–π!",
            "–ö–æ–≥–¥–∞ –ø—è—Ç—ë—Ä–∫–∞ –≤—ã—Ö–æ–¥–∏—Ç –≤ —ç—Ñ–∏—Ä ‚Äî –¢–≤–∏—á –∑–∞–º–æ–ª–∫–∞–µ—Ç –∏ —Å–ª—É—à–∞–µ—Ç –±–æ—Å—Å–∞.",
            "2025 ‚Äî –≥–æ–¥, –∫–æ–≥–¥–∞ –º—ã —Å–Ω–æ–≤–∞ –∑–∞–±–∏—Ä–∞–µ–º –≤—Å—ë, –≤–µ–¥—å 5opka ‚Äî –Ω–∞—à –ª–∏–¥–µ—Ä –∏ –≤–¥–æ—Ö–Ω–æ–≤–∏—Ç–µ–ª—å!",
            "–§—É–≥–æ–±–æ—Ç—ã –Ω–µ —Å–ø—è—Ç, –±—Ä–∞—Ç—É—Ö–∏ –Ω–µ –æ—Ç–¥—ã—Ö–∞—é—Ç ‚Äî Slay 2025 –∑–∞ –Ω–∞–º–∏!",
            "–ü—è—Ç—ë—Ä–∫–∞ ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ –∫–æ–Ω—Ç–µ–Ω—Ç, —ç—Ç–æ –∏—Å–∫—É—Å—Å—Ç–≤–æ –∂–∏—Ç—å –≤ —Ö–∞–π–ø–µ –∏ –¥–æ–±—Ä–æ—Ç–µ.",
            "–ù–∏ –æ–¥–∏–Ω –∫–æ–Ω—Ñ–ª–∏–∫—Ç –Ω–µ –ø–æ–±–µ–¥–∏–ª –±–æ—Å—Å–∞ ‚Äî –µ–≥–æ —Ö–∞—Ä–∏–∑–º–∞ —Å–∏–ª—å–Ω–µ–µ –ª—é–±–æ–π –¥—Ä–∞–º—ã.",
            "–ú—ã –∏–¥—ë–º –∑–∞ 5opka –∫–∞–∫ –∑–∞ —Å–≤–µ—Ç–æ–º ‚Äî –∏ –¥–∞–∂–µ –ú–∞–ª–∏–∫–æ–≤ –∑–Ω–∞–µ—Ç, —á—Ç–æ –ø–æ–±–µ–¥–∞ –∑–∞ –Ω–∞–º–∏!",
            "–ö–∞–∂–¥—ã–π —Ñ—É–≥–æ–±–æ—Ç ‚Äî —á–∞—Å—Ç—å –ª–µ–≥–µ–Ω–¥—ã, –∫–∞–∂–¥—ã–π –ª–∞–π–∫ ‚Äî –∫–∏—Ä–ø–∏—á –≤ —Å—Ç–µ–Ω–µ —Å–ª–∞–≤—ã –ø—è—Ç—ë—Ä–∫–∏!",
            "–¢—Ä–∏ –≥–æ–¥–∞ –ø–æ–¥—Ä—è–¥ ‚Äî –º–µ–º –≥–æ–¥–∞, –∏ —ç—Ç–æ —Ç–æ–ª—å–∫–æ –Ω–∞—á–∞–ª–æ –∏—Å—Ç–æ—Ä–∏–∏ 5opka.",
            "–§—Ä–∏–∫–ª–µ–Ω–¥ –ø—Ä–∏–∑–Ω–∞–Ω –ø—Ä–æ–µ–∫—Ç–æ–º –≥–æ–¥–∞, –ø–æ—Ç–æ–º—É —á—Ç–æ —Ç–∞–º –∂–∏–≤—ë—Ç –¥—É—à–∞ –∫–æ–º—å—é–Ω–∏—Ç–∏ –ø—è—Ç—ë—Ä–∫–∏.",
            "Slay 2025 ‚Äî —Å—Ü–µ–Ω–∞ –¥–ª—è –Ω–∞—Å, –∏ –º—ã —É–∂–µ –∑–Ω–∞–µ–º, –∫—Ç–æ –≤—ã–π–¥–µ—Ç –∑–∞ –∫–æ—Ä–æ–Ω–æ–π ‚Äî –±–æ—Å—Å –¢–≤–∏—á–∞!",
            "5opka ‚Äî —Å—Ç–∞—Ä—ã–π –±–æ–≥ –Ω–æ–≤–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏, —Å—Ç—Ä–∏–º–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–∑–¥–∞–ª —à–∫–æ–ª—É —Ö–∞—Ä–∏–∑–º—ã!",
            "–ú–∏—Ä–æ–≤—ã–µ —Ö–∏—Ç—ã, –ª–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–µ —Å—Ç—Ä–∏–º—ã, –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π –≤–∞–π–± ‚Äî –≤–æ—Ç —Ñ–æ—Ä–º—É–ª–∞ –±–æ—Å—Å–∞!",
            "42 –±—Ä–∞—Ç—É—Ö–∏ –∏ —Ñ—É–≥–æ–±–æ—Ç—ã ‚Äî –Ω–µ —Ñ–∞–Ω–∞—Ç—ã, –∞ —Å–µ–º—å—è, —á—Ç–æ –≤–µ–¥—ë—Ç –ø—è—Ç—ë—Ä–∫—É –∫ –≤–µ—á–Ω–æ–π —Å–ª–∞–≤–µ!",
            "–ö–∞–∂–¥—ã–π –∫–ª–∏–ø –ø—è—Ç—ë—Ä–∫–∏ ‚Äî —Ü–∏—Ç–∞—Ç–∞ —ç–ø–æ—Ö–∏, –∫–∞–∂–¥—ã–π —Å—Ç—Ä–∏–º ‚Äî –ø—Ä–∞–∑–¥–Ω–∏–∫ –¥—É—à–∏!",
            "–¢–≤–∏—á –±–µ–∑ –ø—è—Ç—ë—Ä–∫–∏ ‚Äî –∫–∞–∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –±–µ–∑ –º–µ–º–æ–≤, –ø—É—Å—Ç–æ—Ç–∞ –±–µ–∑ –æ–≥–Ω—è!",
            "–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä—ã –ø—Ä–µ–º–∏–∏ –Ω–µ –≥–æ—Ç–æ–≤—ã –∫ –Ω–∞–ø–æ—Ä—É 42 –±—Ä–∞—Ç—É—Ö ‚Äî –º—ã –±–µ—Ä—ë–º Slay —à—Ç—É—Ä–º–æ–º!",
            "–§—É–≥–æ–±–æ—Ç—ã ‚Äî –¥–≤–∏–∂, –±—Ä–∞—Ç—É—Ö–∏ ‚Äî —Å–∏–ª–∞, –ø—è—Ç—ë—Ä–∫–∞ ‚Äî –ª–µ–≥–µ–Ω–¥–∞, Slay ‚Äî –Ω–∞—à–∞ —Å—Ü–µ–Ω–∞!",
            "–ö–æ–≥–¥–∞ –≥–æ–≤–æ—Ä—è—Ç ¬´–∫–æ–Ω—Ç–µ–Ω—Ç¬ª, —Å–ª—ã—à–∏—Ç—Å—è ¬´–ø—è—Ç—ë—Ä–∫–∞¬ª ‚Äî –∏ —ç—Ç–æ —Ñ–∞–∫—Ç, –ø—Ä–∏–∑–Ω–∞–Ω–Ω—ã–π –≤—Å–µ–º –¢–≤–∏—á–æ–º!"
          ];
          

          const hashtags = [
            "#–ü—è—Ç–µ—Ä–∫–∞", 
            "#5opka", 
            "#–§—É–≥–æ–±–æ—Ç—ã", 
            "#42–ë—Ä–∞—Ç—É—Ö–∏", 
            "#Slay2025", 
            "#SlayKing", 
            "#–§—Ä–∏–∫–ª–µ–Ω–¥", 
            "#–ü—Ä–æ–µ–∫—Ç–ì–æ–¥–∞", 
            "#–ú–µ–º–ì–æ–¥–∞", 
            "#5opkaBoss", 
            "#–ë–æ—Å—Å–¢–≤–∏—á–∞", 
            "#–õ–µ–≥–µ–Ω–¥–∞–¢–≤–∏—á–∞", 
            "#–ì–µ–Ω–∏–π–ö–æ–Ω—Ç–µ–Ω—Ç–∞", 
            "#–ú–µ–¥–∏–∞–ê–∫—É–ª–∞", 
            "#5opka–ê—Ä–º–∏—è", 
            "#–ú—ã42", 
            "#–ñ–æ–ø–∞XXL", 
            "#–¢—Ä–µ–∫42", 
            "#–ë—Ä–∞—Ç—É—Ö–∏–ó–∞–ë–æ—Å—Å–∞", 
            "#–ü—è—Ç–µ—Ä–∫–∞–ù–∞–≤—Å–µ–≥–¥–∞", 
            "#–§—É–≥–æ–±–æ—Ç—ã–û–Ω–ª–∞–π–Ω", 
            "#5opkaSlayKing", 
            "#–°–ª–∞–≤–∞–ë—É—Å—Ç–µ—Ä–í–®–æ–∫–µ", 
            "#–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä—ã–í–®–æ–∫–µ", 
            "#–§—É–≥–æ–±–æ—Ç–î–≤–∏–∂", 
            "#–§—Ä–∏–∫–ª–µ–Ω–¥–¢–æ–ø", 
            "#–¢–≤–∏—á–ù–∞—à–î–æ–º", 
            "#–ö–æ–Ω—Ç–µ–Ω—Ç–ë–æ–≥–∞", 
            "#–ü—è—Ç–µ—Ä–∫–∞–ó–∞–≤–æ–∑–∏—Ç", 
            "#5opka–ú–µ–º–ú–∞—Å—Ç–µ—Ä", 
            "#–ü—è—Ç–µ—Ä–∫–∞2025", 
            "#–¢–æ–ø–∏–º–ó–∞–ü—è—Ç–µ—Ä–∫—É", 
            "#–ü—è—Ç–µ—Ä–∫–∞–ë–æ—Å—Å", 
            "#–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π–ö–æ–Ω—Ç–µ–Ω—Ç", 
            "#–§—É–≥–æ–±–æ—Ç—ã–°–∏–ª–∞", 
            "#42–ò–¥–µ—Ç–ö–ü–æ–±–µ–¥–µ", 
            "#–ë—Ä–∞—Ç—Å—Ç–≤–æ42", 
            "#5opkaForever", 
            "#5opkaCommunity", 
            "#–§—Ä–∏–∫–ª–µ–Ω–¥–ù–∞–≤—Å–µ–≥–¥–∞", 
            "#–¢–≤–∏—á–õ–µ–≥–µ–Ω–¥–∞", 
            "#5opkaGenius"
          ];
          

          const randomPhoto = photos[Math.floor(Math.random() * photos.length)];
          const hashtaId = Math.floor(Math.random() * hashtags.length);
          const randomComment =
            comments[Math.floor(Math.random() * comments.length)];

          await client.sendMessage(commentGroupId.chat, {
            file: randomPhoto,
            message: `<blockquote><b>${randomComment}</b></blockquote>\n ${
              hashtags[hashtaId]
            } ${hashtags[hashtaId > hashtags.length - 2 ? 0 : hashtaId + 1]} ${
              hashtags[hashtaId > hashtags.length - 3 ? 0 : hashtaId + 2]
            }`,
            parseMode: "html",
            replyTo: message.id,
          });

          console.log("‚úÖ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω:");
        }
      }, new NewMessage({ chats: [commentGroupId.chat] }));
    }
    app.get("/sleep", async (req, res) => {
      res.send({ type: 200 });
    });
  } catch (err) {
    console.error("‚ùå –ù–µ–ø—Ä–µ–¥–≤–∏–¥–µ–Ω–Ω–∞—è –æ—à–∏–±–∫–∞:", err);
    process.exit(1);
  }
}
startApp();

app.listen(3001, (err) => {
  err ? err : console.log("STARTED SERVER");
});
